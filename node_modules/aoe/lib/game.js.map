{"version":3,"sources":["webpack:///webpack/bootstrap edcb8231b0b97fa27f7f","webpack:///./src/Game.js","webpack:///./src/Layer.js","webpack:///./src/Resource.js"],"names":["Game","layers","Layers","name","options","layer","push","onProgress","initPromise","init","callback","then","step","elapse","forEach","render","_stop","requestAnimationFrame","bind","src","load","Resource","window","Layer","canvas","position","dpr","z","container","document","body","newCreate","createElement","width","innerWidth","height","innerHeight","style","undefined","zIndex","left","top","appendChild","startTime","ctx","getContext","gameObjectList","_pause","image","align","backgroundImage","backgroundSize","backgroundPosition","background","backgroundAlign","targetHeight","drawImage","interval","clearRect","sort","a","b","go","drawBackground","m","exec","ext","type","types","some","t","regexp","test","resourceMap","classMap","Error","resources","complete","keys","Object","all","length","progress","Promise","map","key","ImageResource","Image","resolve","reject","onload","onerror"],"mappings":"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","file":"game.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap edcb8231b0b97fa27f7f\n **/","/**\n * Created by exolution on 17/6/14.\n */\nimport Layer from './Layer'\nimport Resource from './Resource'\nclass Game{\n    constructor(){\n        this.layers=[]\n        this.Layers={}\n    }\n\n    createLayer(name,options){\n        let layer=new Layer(name,options)\n        this.layers.push(layer)\n        this.Layers[name]=layer\n    }\n    init(onProgress){\n        this.initPromise=Resource.init(onProgress)\n        return this\n    }\n    start(callback){\n\n        this.initPromise.then(()=> {\n            this.step = function (elapse) {\n                /*glIntervalList.forEach(function (itv) {\n                 itv.testOrRun(elapse, interval)\n                 })*/\n                this.layers.forEach((layer)=> {\n                    layer.render(elapse)\n                })\n                if (!this._stop)requestAnimationFrame(this.step.bind(this))\n            }\n            requestAnimationFrame(this.step.bind(this))\n            callback()\n        })\n        return this\n    }\n    loadResource(src,name){\n        Resource.load(src,name)\n        return this\n    }\n}\nGame.Resource=Resource\nwindow.Game=Game\n\n\n/** WEBPACK FOOTER **\n ** ./src/Game.js\n **/","/**\n * Created by exolution on 17/6/14.\n */\nexport default class Layer {\n    constructor(name, {canvas,position,dpr,z,container=document.body}={}) {\n        this.name = name\n        let newCreate = false\n        if (!canvas) {\n            canvas = document.createElement('canvas')\n            newCreate = true\n        }\n        else {\n\n        }\n        if (!dpr || dpr > 2) {\n            dpr = 1\n        }\n        let width = position && position[2] || window.innerWidth,\n            height = position && position[3] || window.innerHeight\n        this.width = canvas.width = width * dpr\n        this.height = canvas.height = height * dpr\n        canvas.style.width = width\n        canvas.style.height = height\n        if (z !== undefined) {\n            canvas.style.zIndex = z\n        }\n        canvas.style.position = 'absolute'\n        if (position) {\n            canvas.style.left = position[0] + 'px'\n            canvas.style.top = position[1] + 'px'\n        }\n        if (newCreate) {\n            container.appendChild(canvas)\n\n        }\n        this.startTime = 0\n        this.canvas = canvas\n\n        this.ctx = canvas.getContext('2d')\n        this.gameObjectList = []\n        this._pause = false\n    }\n\n    pause() {\n        this._pause = true\n    }\n\n    resume() {\n        this._pause = false\n    }\n    setBackground(image,align='top'){\n        if(typeof image==='string') {\n            this.canvas.style.backgroundImage = `url(${image})`\n            this.canvas.style.backgroundSize = '100% auto';\n            this.canvas.style.backgroundPosition = `center ${align}`;\n            this.background=null\n        }\n        else{\n            this.background=image\n            this.backgroundAlign=align\n        }\n    }\n    drawBackground(){\n        if(this.background){\n            let targetHeight=this.width/this.background.image.width*this.background.image.height\n            if(targetHeight>=this.height){\n                this.ctx.drawImage(\n                    this.background.image,\n                    0,\n                    this.backgroundAlign=='bottom'?this.background.image.height-this.background.image.width/this.width*this.height:0 ,\n                    this.background.image.width,\n                    this.background.image.width/this.width*this.height,\n                    0,0,this.width,this.height\n                )\n            }\n            else{\n                this.ctx.drawImage(\n                    this.background.image,\n                    (this.background.image.width-this.background.image.height/this.height*this.width)/2,\n                    0,\n                    this.background.image.height/this.height*this.width,\n                    this.background.image.height,\n                    0,0,this.width,this.height\n                )\n\n            }\n        }\n    }\n    render(elapse) {\n        if (!this._pause) {\n            let interval = elapse - this.startTime\n            this.startTime = elapse\n            if (interval > 1000) {\n                interval = 16.7\n            }\n            this.ctx.clearRect(0, 0, this.width, this.height)\n            this.gameObjectList.sort((a, b)=>a.z - b.z).forEach( (go)=> {\n                go.render(this.ctx, elapse, interval)\n            })\n            this.drawBackground()\n        }\n        /*glIntervalList.forEach(function (itv) {\n         itv.testOrRun(elapse, interval)\n         })*/\n    }\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Layer.js\n **/","/**\n * Created by exolution on 17/6/14.\n */\nexport default class Resource{\n    static load(src,name){\n        let m=/\\.([^.]+)$/.exec(src)\n        let ext=m&&m[1]\n        let type\n        Resource.types.some((t)=>{\n            if(t.regexp.test(ext)){\n                type=t.type\n                return true\n            }\n        })\n        if(type) {\n            Resource.resourceMap[name||src]=new Resource.classMap[type](src,name)\n        }\n        else{\n            throw new Error('unsupported resource format \"'+ext+'\"')\n        }\n        return Resource.resourceMap[name||src]\n    }\n    static get(name){\n        return Resource.resourceMap[name]\n    }\n    static init(onProgress){\n        let resources=[]\n        let complete=0\n        let keys=Object.keys(Resource.resourceMap)\n        let all=keys.length\n        function progress(){\n            onProgress(++complete,all)\n        }\n        return Promise.all(keys.map(key=>Resource.resourceMap[key].init(progress)))\n\n    }\n    constructor(src,name){\n        return Resource.load(src,name)\n    }\n}\nclass ImageResource{\n    constructor(src,name){\n        this.src=src\n        this.name=name\n    }\n    init(onProgress){\n        this.image=new Image()\n        this.image.src=this.src\n        return new Promise((resolve,reject)=>{\n            this.image.onload=function(){\n                resolve()\n                if(onProgress){\n                    onProgress()\n                }\n            }\n            this.image.onerror=function(){\n                reject(this)\n            }\n        })\n\n    }\n}\nResource.types=[\n    {regexp:/png|gif|jpe?g/,type:'image'}\n]\nResource.resourceMap={}\nResource.classMap={\n    image:ImageResource\n}\n\n\n/** WEBPACK FOOTER **\n ** ./src/Resource.js\n **/"],"sourceRoot":""}